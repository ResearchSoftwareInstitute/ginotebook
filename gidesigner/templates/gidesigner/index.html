{% load staticfiles %}
<!DOCTYPE html> <!-- Adapted from: https://github.com/iandevlin/html5bones -->
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>GI Designer</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link href="{% static 'css/normalize.css' %}" rel="stylesheet" media="all">
    <link href="{% static 'css/styles.css' %}" rel="stylesheet" media="all">

    <link href="{% static 'css/ol.css' %}" rel="stylesheet">

    <style>
      .map {
        height: 400px;
        width: 100%;
        float: left;
      }
    </style>

    <script src="{% static 'js/jquery-2.1.4.js' %}" media="all"></script>

    <script>
        // Set up watershed selector
        var boundary = {};
        $.get("{{ watersheds_url }}", function(response) {
            console.log( response);
            var select = $("#watershed");
            select.empty();
            select.append($("<option>", { value: "-1", html: "Select a watershed"}));
            for (i = 0; i < response.results.length; i++) {
                var ws = response.results[i];
                console.log(ws.name);
                boundary[ws.id] = ws.boundary;
                select.append($("<option>", { value: ws.id, html: ws.name }));
            }
        });
    </script>



    <script src="{% static 'js/ol.js' %}" type="text/javascript"></script>
    <!--[if lt IE 9]><script src="{% static 'js/html5shiv-printshiv.js' %}" media="all"></script><![endif]-->

</head>
<body>
    <header role="banner">
        <nav role="navigation">
          <b>GI Designer</b>
        </nav>
    </header>

    <div class="wrap">
        <main role="main">
            <div id="controls">
                <form action="{% url 'gidesigner:main' %}" method="post">
                    {% csrf_token %}
                    Available watersheds:
                    <select name="watershed" id="watershed" onchange="showWatershedMap(this.value)"></select>
                    <input type="submit" value="Select watershed">
                </form>
                <br>
            </div>
            <div id="map" class="map"></div>
            <script type="text/javascript">
                // Set up map
                var map = new ol.Map({
                    target: 'map',
                    layers: [
                      new ol.layer.Tile({
                        source: new ol.source.OSM()
                      })
                    ],
                    view: new ol.View({
                      center: ol.proj.transform([-76, 37], 'EPSG:4326', 'EPSG:3857'),
                      zoom: 4
                    })
                });

                function showWatershedMap(watershed_id) {
                    if (watershed_id != "-1") {
                        console.log(boundary[watershed_id]);
                        $.get(boundary[watershed_id], function(response) {
                            //console.log(response);
                            map.addLayer(new ol.layer.Vector({
                                source: new ol.source.Vector({
                                    features: new ol.format.GeoJSON().readFeature(response.boundary)
                                })
                            }));
                        });
                    }
                }
            </script>
        </main>
    </div>

    <footer role="contentinfo">
        <!-- <small>Copyright &copy; <time datetime="2015">2015</time></small> -->
    </footer>

</body>
</html>